# AFig Screener Online

A Python tool for screening and filtering protein structures generated by AlphaFold2 (AF2) with AFig (AlphaFold initial guess) for computational protein binder design.

## Overview

**AFig (AlphaFold initial guess)** refers to providing original structures to AlphaFold to save computational time during protein prediction. This tool is designed to test designed binders by screening and filtering AlphaFold2-generated structures.

AFig_screener_online automates the process of comparing original and AF2-generated protein structures, calculating structural alignment scores (TM-scores), and filtering candidates based on interaction quality metrics. The tool filters out bad binders and keeps only the good ones (top 5% based on PAE interaction scores). This enables efficient iterative protein binder design workflows where multiple rounds of generation and screening are performed.

## Features

- **Automated Structure Alignment**: Uses USalign to calculate TM-scores between original and generated protein structures
- **Parallel Processing**: Multi-threaded execution for efficient processing of large structure sets
- **Quality Filtering**: Screens structures based on:
  - TM-score thresholds (off-target filtering)
  - PAE (Predicted Aligned Error) interaction scores (binding strength)
- **Sequence Extraction**: Automatically extracts binder sequences from filtered candidates
- **Iterative Workflow Support**: Organized output for seamless integration into multi-round design pipelines

## Requirements

The project uses a conda environment with the following key dependencies:

- Python 3.10
- BioPython 1.85
- pandas 2.3.3
- numpy 2.2.6
- USalign (for structure alignment)
- tqdm (for progress tracking)

See `envirnoment.yml` for the complete list of dependencies.

## Installation

1. Clone the repository:
```bash
git clone https://github.com/Phoenix-Chen-Git/AFig_screener_online.git
cd AFig_screener_online
```

2. Create and activate the conda environment:
```bash
conda env create -f envirnoment.yml
conda activate AF_ig
```

## Usage

### Command Line Interface

```bash
python AFig_screen_online.py \
  -ori <original_pdb_directory> \
  -g <generated_pdb_directory> \
  -p <project_name> \
  -iter <iteration_number> \
  -a <af2igpae_file>
```

### Arguments

| Argument | Short | Type | Required | Description |
|----------|-------|------|----------|-------------|
| `--origin_pdb_dir` | `-ori` | str | Yes | Directory containing original PDB structures (used as initial guess for AlphaFold) |
| `--generated_pdb_dir` | `-g` | str | Yes | Directory containing PDB structures generated by AlphaFold2 with initial guess |
| `--project_name` | `-p` | str | Yes | Name of your project (used for output file naming) |
| `--iteration` | `-iter` | int | Yes | Current iteration number |
| `--af2igpae_dir` | `-a` | str | Yes | Path to AF2 PAE interaction scores file |

### Example

```bash
python AFig_screen_online.py \
  -ori ./pdbs_original/ \
  -g ./pdbs_generated/ \
  -p my_binder_project \
  -iter 1 \
  -a ./af2_scores.txt
```

## Workflow

The tool performs the following steps:

1. **Structure Matching**: Matches original and generated PDB files based on naming patterns
2. **TM-Score Calculation**: Computes structural similarity using USalign (parallel processing)
3. **Off-Target Filtering**: Removes structures with TM-score â‰¤ 0.95 (indicating significant structural deviation)
4. **PAE-Based Screening**: Filters candidates based on the bottom 5% quantile of PAE interaction scores
5. **Candidate Selection**: Saves passing structures to a new directory for the next iteration
6. **Sequence Extraction**: Extracts chain A sequences from selected candidates for validation

## Output Files

For a project named `PROJECT` at iteration `N`, the tool generates:

| File | Description |
|------|-------------|
| `PROJECT_Aligned_N.csv` | Raw alignment results with TM-scores for all structures |
| `PROJECT_full_score_N.csv` | Combined TM-scores and PAE interaction data |
| `PROJECT_Screened_N.csv` | Final filtered candidates passing all criteria |
| `PROJECT_binder_sequences_N.csv` | Chain A sequences from selected candidates |
| `PROJECT_N+1candidates/` | Directory containing PDB files of selected candidates for next iteration |

## File Naming Conventions

- **Original PDBs**: Should have a base name that can be extracted (e.g., `structure_name.pdb`)
- **Generated PDBs**: Should follow the pattern `name_*_af2pred.pdb` where `name` matches the original structure

## Screening Criteria

The tool filters out bad binders and keeps only the top 5% good binders based on:

1. **TM-Score Threshold**: Structures with TM-score > 0.95 pass (maintains structural similarity to original)
2. **PAE Interaction**: Only candidates with PAE interaction scores in the lowest 5% are selected (indicates strong predicted binding - lower PAE scores mean better binding quality)

## Dependencies and Tools

- **USalign**: Required for structural alignment (automatically installed via conda)
- **BioPython**: For PDB parsing and sequence extraction
- **pandas**: For data manipulation and CSV operations
- **concurrent.futures**: For parallel processing (built-in)

## Performance

The tool uses multi-threaded processing (default: 14 workers) to accelerate TM-score calculations. Processing time depends on:
- Number of structures
- Structure size
- Available CPU cores

## Troubleshooting

### Common Issues

1. **File not found errors**: Ensure PDB directories end with `/` and contain the expected files
2. **USalign errors**: Verify USalign is properly installed in the conda environment
3. **Memory issues**: Reduce the number of workers in `ThreadPoolExecutor` if running on limited resources

## Citation

If you use this tool in your research, please cite the relevant papers for:
- AlphaFold2
- USalign: Zhang, C., & Shine, M. (2022). US-align: universal structure alignment of proteins, nucleic acids, and macromolecular complexes. *Nature Methods*

## License

Please check with the repository owner for license information.

## Contributing

Contributions are welcome! Please feel free to submit issues or pull requests.

## Contact

For questions or issues, please open an issue on the GitHub repository.
